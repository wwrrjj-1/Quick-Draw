<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quick Draw - AI æ¶‚é¸¦è¯†åˆ«</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
            touch-action: none;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header {
            text-align: center;
            color: white;
            flex-shrink: 0;
            margin-bottom: 8px;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        /* å·¥å…·æ  */
        .toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-shrink: 0;
            align-items: center;
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .tool-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-btn:active {
            transform: scale(0.92);
        }

        .tool-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .size-slider {
            width: 80px;
            height: 6px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            outline: none;
        }

        .size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .size-label {
            color: white;
            font-size: 12px;
            min-width: 24px;
            text-align: center;
        }

        /* ç”»æ¿åŒºåŸŸ */
        .canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 360px;
            min-height: 0;
        }

        .canvas-wrapper {
            background: white;
            border-radius: 20px;
            padding: 6px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            width: 100%;
            aspect-ratio: 1;
            max-height: 100%;
        }

        #canvas {
            width: 100%;
            height: 100%;
            border-radius: 14px;
            background: white;
            cursor: crosshair;
            touch-action: none;
        }

        #canvas.eraser-mode {
            cursor: cell;
        }

        /* ç»“æœåŒºåŸŸ - å›ºå®šé«˜åº¦ */
        .results {
            width: 100%;
            max-width: 360px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 12px;
            flex-shrink: 0;
            height: 160px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .results-title {
            color: white;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
        }

        .result-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            color: white;
        }

        .result-rank {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .result-item:first-child .result-rank {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #333;
        }

        .result-item:nth-child(2) .result-rank {
            background: linear-gradient(135deg, #c0c0c0, #a0a0a0);
            color: #333;
        }

        .result-item:nth-child(3) .result-rank {
            background: linear-gradient(135deg, #cd7f32, #b8860b);
            color: #fff;
        }

        .result-name {
            flex: 1;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .result-bar {
            width: 60px;
            height: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            margin: 0 10px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .result-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #fff, rgba(255,255,255,0.7));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .result-conf {
            font-size: 12px;
            opacity: 0.9;
            min-width: 40px;
            text-align: right;
        }

        .placeholder {
            text-align: center;
            color: rgba(255,255,255,0.7);
            font-size: 13px;
            padding: 40px 0;
        }

        /* æŒ‰é’®åŒºåŸŸ */
        .buttons {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 360px;
            margin-top: 10px;
            flex-shrink: 0;
        }

        .btn {
            flex: 1;
            height: 48px;
            border: none;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-clear {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .btn-predict {
            background: white;
            color: #667eea;
            flex: 2;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-predict:disabled {
            opacity: 0.6;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .btn-predict.loading-state .loading {
            display: block;
        }

        .btn-predict.loading-state .btn-text {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¨ Quick Draw Â· AI æ¶‚é¸¦è¯†åˆ«</h1>
    </div>

    <!-- å·¥å…·æ  -->
    <div class="toolbar">
        <button class="tool-btn active" id="penBtn" title="ç”»ç¬”">âœï¸</button>
        <button class="tool-btn" id="eraserBtn" title="æ©¡çš®æ“¦">ğŸ§½</button>
        <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.3); margin: 0 4px;"></div>
        <span class="size-label" id="sizeLabel">6</span>
        <input type="range" class="size-slider" id="sizeSlider" min="2" max="20" value="6">
    </div>

    <div class="canvas-container">
        <div class="canvas-wrapper">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <div class="results" id="results">
        <div class="placeholder">åœ¨ä¸Šæ–¹ç”»æ¿ç»˜ç”»åç‚¹å‡»è¯†åˆ«</div>
    </div>

    <div class="buttons">
        <button class="btn btn-clear" id="clearBtn">ğŸ—‘ï¸ æ¸…é™¤</button>
        <button class="btn btn-predict" id="predictBtn">
            <span class="btn-text">âœ¨ è¯†åˆ«</span>
            <div class="loading"></div>
        </button>
    </div>

    <script>
        // å®Œæ•´ 345 ç±»åˆ«ä¸­è‹±æ–‡æ˜ å°„
        const categoryTranslations = {
            'aircraft carrier': 'èˆªç©ºæ¯èˆ°', 'airplane': 'é£æœº', 'alarm clock': 'é—¹é’Ÿ',
            'ambulance': 'æ•‘æŠ¤è½¦', 'angel': 'å¤©ä½¿', 'animal migration': 'åŠ¨ç‰©è¿å¾™',
            'ant': 'èš‚èš', 'anvil': 'é“ç §', 'apple': 'è‹¹æœ', 'arm': 'æ‰‹è‡‚',
            'asparagus': 'èŠ¦ç¬‹', 'axe': 'æ–§å¤´', 'backpack': 'èƒŒåŒ…', 'banana': 'é¦™è•‰',
            'bandage': 'ç»·å¸¦', 'barn': 'è°·ä»“', 'baseball': 'æ£’çƒ', 'baseball bat': 'æ£’çƒæ£’',
            'basket': 'ç¯®å­', 'basketball': 'ç¯®çƒ', 'bat': 'è™è ', 'bathtub': 'æµ´ç¼¸',
            'beach': 'æµ·æ»©', 'bear': 'ç†Š', 'beard': 'èƒ¡å­', 'bed': 'åºŠ', 'bee': 'èœœèœ‚',
            'belt': 'è…°å¸¦', 'bench': 'é•¿å‡³', 'bicycle': 'è‡ªè¡Œè½¦', 'binoculars': 'æœ›è¿œé•œ',
            'bird': 'é¸Ÿ', 'birthday cake': 'ç”Ÿæ—¥è›‹ç³•', 'blackberry': 'é»‘è“',
            'blueberry': 'è“è“', 'book': 'ä¹¦', 'boomerang': 'å›æ—‹é•–', 'bottlecap': 'ç“¶ç›–',
            'bowtie': 'è´è¶ç»“', 'bracelet': 'æ‰‹é•¯', 'brain': 'å¤§è„‘', 'bread': 'é¢åŒ…',
            'bridge': 'æ¡¥', 'broccoli': 'è¥¿å…°èŠ±', 'broom': 'æ‰«å¸š', 'bucket': 'æ°´æ¡¶',
            'bulldozer': 'æ¨åœŸæœº', 'bus': 'å…¬äº¤è½¦', 'bush': 'çŒæœ¨', 'butterfly': 'è´è¶',
            'cactus': 'ä»™äººæŒ', 'cake': 'è›‹ç³•', 'calculator': 'è®¡ç®—å™¨', 'calendar': 'æ—¥å†',
            'camel': 'éª†é©¼', 'camera': 'ç›¸æœº', 'camouflage': 'è¿·å½©', 'campfire': 'ç¯ç«',
            'candle': 'èœ¡çƒ›', 'cannon': 'å¤§ç‚®', 'canoe': 'ç‹¬æœ¨èˆŸ', 'car': 'æ±½è½¦',
            'carrot': 'èƒ¡èåœ', 'castle': 'åŸå ¡', 'cat': 'çŒ«', 'ceiling fan': 'åŠæ‰‡',
            'cell phone': 'æ‰‹æœº', 'cello': 'å¤§æç´', 'chair': 'æ¤…å­', 'chandelier': 'åŠç¯',
            'church': 'æ•™å ‚', 'circle': 'åœ†å½¢', 'clarinet': 'å•ç°§ç®¡', 'clock': 'æ—¶é’Ÿ',
            'cloud': 'äº‘', 'coffee cup': 'å’–å•¡æ¯', 'compass': 'æŒ‡å—é’ˆ', 'computer': 'ç”µè„‘',
            'cookie': 'é¥¼å¹²', 'cooler': 'å†·è—ç®±', 'couch': 'æ²™å‘', 'cow': 'ç‰›',
            'crab': 'èƒèŸ¹', 'crayon': 'èœ¡ç¬”', 'crocodile': 'é³„é±¼', 'crown': 'çš‡å† ',
            'cruise ship': 'æ¸¸è½®', 'cup': 'æ¯å­', 'diamond': 'é’»çŸ³', 'dishwasher': 'æ´—ç¢—æœº',
            'diving board': 'è·³æ°´æ¿', 'dog': 'ç‹—', 'dolphin': 'æµ·è±š', 'donut': 'ç”œç”œåœˆ',
            'door': 'é—¨', 'dragon': 'é¾™', 'dresser': 'æ¢³å¦†å°', 'drill': 'ç”µé’»',
            'drums': 'é¼“', 'duck': 'é¸­å­', 'dumbbell': 'å“‘é“ƒ', 'ear': 'è€³æœµ',
            'elbow': 'è‚˜éƒ¨', 'elephant': 'å¤§è±¡', 'envelope': 'ä¿¡å°', 'eraser': 'æ©¡çš®æ“¦',
            'eye': 'çœ¼ç›', 'eyeglasses': 'çœ¼é•œ', 'face': 'è„¸', 'fan': 'é£æ‰‡',
            'feather': 'ç¾½æ¯›', 'fence': 'æ …æ ', 'finger': 'æ‰‹æŒ‡', 'fire hydrant': 'æ¶ˆé˜²æ “',
            'fireplace': 'å£ç‚‰', 'firetruck': 'æ¶ˆé˜²è½¦', 'fish': 'é±¼', 'flamingo': 'ç«çƒˆé¸Ÿ',
            'flashlight': 'æ‰‹ç”µç­’', 'flip flops': 'äººå­—æ‹–', 'floor lamp': 'è½åœ°ç¯',
            'flower': 'èŠ±', 'flying saucer': 'é£ç¢Ÿ', 'foot': 'è„š', 'fork': 'å‰å­',
            'frog': 'é’è›™', 'frying pan': 'å¹³åº•é”…', 'garden': 'èŠ±å›­', 'garden hose': 'æ°´ç®¡',
            'giraffe': 'é•¿é¢ˆé¹¿', 'goatee': 'å±±ç¾Šèƒ¡', 'golf club': 'é«˜å°”å¤«çƒæ†',
            'grapes': 'è‘¡è„', 'grass': 'è‰', 'guitar': 'å‰ä»–', 'hamburger': 'æ±‰å ¡',
            'hammer': 'é”¤å­', 'hand': 'æ‰‹', 'harp': 'ç«–ç´', 'hat': 'å¸½å­',
            'headphones': 'è€³æœº', 'hedgehog': 'åˆºçŒ¬', 'helicopter': 'ç›´å‡æœº',
            'helmet': 'å¤´ç›”', 'hexagon': 'å…­è¾¹å½¢', 'hockey puck': 'å†°çƒ',
            'hockey stick': 'æ›²æ£çƒæ£’', 'horse': 'é©¬', 'hospital': 'åŒ»é™¢',
            'hot air balloon': 'çƒ­æ°”çƒ', 'hot dog': 'çƒ­ç‹—', 'hot tub': 'çƒ­æ°´æµ´ç¼¸',
            'hourglass': 'æ²™æ¼', 'house': 'æˆ¿å­', 'house plant': 'ç›†æ ½', 'hurricane': 'é£“é£',
            'ice cream': 'å†°æ·‡æ·‹', 'jacket': 'å¤¹å…‹', 'jail': 'ç›‘ç‹±', 'kangaroo': 'è¢‹é¼ ',
            'key': 'é’¥åŒ™', 'keyboard': 'é”®ç›˜', 'knee': 'è†ç›–', 'knife': 'åˆ€',
            'ladder': 'æ¢¯å­', 'lantern': 'ç¯ç¬¼', 'laptop': 'ç¬”è®°æœ¬ç”µè„‘', 'leaf': 'å¶å­',
            'leg': 'è…¿', 'light bulb': 'ç¯æ³¡', 'lighter': 'æ‰“ç«æœº', 'lighthouse': 'ç¯å¡”',
            'lightning': 'é—ªç”µ', 'line': 'çº¿æ¡', 'lion': 'ç‹®å­', 'lipstick': 'å£çº¢',
            'lobster': 'é¾™è™¾', 'lollipop': 'æ£’æ£’ç³–', 'mailbox': 'é‚®ç®±', 'map': 'åœ°å›¾',
            'marker': 'é©¬å…‹ç¬”', 'matches': 'ç«æŸ´', 'megaphone': 'æ‰©éŸ³å™¨', 'mermaid': 'ç¾äººé±¼',
            'microphone': 'éº¦å…‹é£', 'microwave': 'å¾®æ³¢ç‚‰', 'monkey': 'çŒ´å­', 'moon': 'æœˆäº®',
            'mosquito': 'èšŠå­', 'motorbike': 'æ‘©æ‰˜è½¦', 'mountain': 'å±±', 'mouse': 'è€é¼ ',
            'moustache': 'èƒ¡é¡»', 'mouth': 'å˜´å·´', 'mug': 'é©¬å…‹æ¯', 'mushroom': 'è˜‘è‡',
            'nail': 'é’‰å­', 'necklace': 'é¡¹é“¾', 'nose': 'é¼»å­', 'ocean': 'æµ·æ´‹',
            'octagon': 'å…«è¾¹å½¢', 'octopus': 'ç« é±¼', 'onion': 'æ´‹è‘±', 'oven': 'çƒ¤ç®±',
            'owl': 'çŒ«å¤´é¹°', 'paint can': 'æ²¹æ¼†æ¡¶', 'paintbrush': 'ç”»ç¬”', 'palm tree': 'æ£•æ¦ˆæ ‘',
            'panda': 'ç†ŠçŒ«', 'pants': 'è£¤å­', 'paper clip': 'å›å½¢é’ˆ', 'parachute': 'é™è½ä¼',
            'parrot': 'é¹¦é¹‰', 'passport': 'æŠ¤ç…§', 'peanut': 'èŠ±ç”Ÿ', 'pear': 'æ¢¨',
            'peas': 'è±Œè±†', 'pencil': 'é“…ç¬”', 'penguin': 'ä¼é¹…', 'piano': 'é’¢ç´',
            'pickup truck': 'çš®å¡è½¦', 'picture frame': 'ç›¸æ¡†', 'pig': 'çŒª', 'pillow': 'æ•å¤´',
            'pineapple': 'è è', 'pizza': 'æŠ«è¨', 'pliers': 'é’³å­', 'police car': 'è­¦è½¦',
            'pond': 'æ± å¡˜', 'pool': 'æ¸¸æ³³æ± ', 'popsicle': 'å†°æ£’', 'postcard': 'æ˜ä¿¡ç‰‡',
            'potato': 'åœŸè±†', 'power outlet': 'ç”µæºæ’åº§', 'purse': 'é’±åŒ…', 'rabbit': 'å…”å­',
            'raccoon': 'æµ£ç†Š', 'radio': 'æ”¶éŸ³æœº', 'rain': 'é›¨', 'rainbow': 'å½©è™¹',
            'rake': 'è€™å­', 'remote control': 'é¥æ§å™¨', 'rhinoceros': 'çŠ€ç‰›', 'rifle': 'æ­¥æª',
            'river': 'æ²³æµ', 'roller coaster': 'è¿‡å±±è½¦', 'rollerskates': 'æ—±å†°é‹',
            'sailboat': 'å¸†èˆ¹', 'sandwich': 'ä¸‰æ˜æ²»', 'saw': 'é”¯å­', 'saxophone': 'è¨å…‹æ–¯',
            'school bus': 'æ ¡è½¦', 'scissors': 'å‰ªåˆ€', 'scorpion': 'èå­', 'screwdriver': 'èºä¸åˆ€',
            'sea turtle': 'æµ·é¾Ÿ', 'see saw': 'è··è··æ¿', 'shark': 'é²¨é±¼', 'sheep': 'ç»µç¾Š',
            'shoe': 'é‹å­', 'shorts': 'çŸ­è£¤', 'shovel': 'é“²å­', 'sink': 'æ°´æ§½',
            'skateboard': 'æ»‘æ¿', 'skull': 'éª·é«…', 'skyscraper': 'æ‘©å¤©å¤§æ¥¼',
            'sleeping bag': 'ç¡è¢‹', 'smiley face': 'ç¬‘è„¸', 'snail': 'èœ—ç‰›', 'snake': 'è›‡',
            'snorkel': 'æ½œæ°´é¢ç½©', 'snowflake': 'é›ªèŠ±', 'snowman': 'é›ªäºº',
            'soccer ball': 'è¶³çƒ', 'sock': 'è¢œå­', 'speedboat': 'å¿«è‰‡', 'spider': 'èœ˜è››',
            'spoon': 'å‹ºå­', 'spreadsheet': 'ç”µå­è¡¨æ ¼', 'square': 'æ­£æ–¹å½¢', 'squiggle': 'æ³¢æµªçº¿',
            'squirrel': 'æ¾é¼ ', 'stairs': 'æ¥¼æ¢¯', 'star': 'æ˜Ÿæ˜Ÿ', 'steak': 'ç‰›æ’',
            'stereo': 'éŸ³å“', 'stethoscope': 'å¬è¯Šå™¨', 'stitches': 'ç¼é’ˆ', 'stop sign': 'åœæ­¢æ ‡å¿—',
            'stove': 'ç‚‰å­', 'strawberry': 'è‰è“', 'streetlight': 'è·¯ç¯', 'string bean': 'å››å­£è±†',
            'submarine': 'æ½œæ°´è‰‡', 'suitcase': 'è¡Œæç®±', 'sun': 'å¤ªé˜³', 'swan': 'å¤©é¹…',
            'sweater': 'æ¯›è¡£', 'swing set': 'ç§‹åƒ', 'sword': 'å‰‘', 'syringe': 'æ³¨å°„å™¨',
            't-shirt': 'Tæ¤', 'table': 'æ¡Œå­', 'teapot': 'èŒ¶å£¶', 'teddy-bear': 'æ³°è¿ªç†Š',
            'telephone': 'ç”µè¯', 'television': 'ç”µè§†', 'tennis racquet': 'ç½‘çƒæ‹',
            'tent': 'å¸ç¯·', 'The Eiffel Tower': 'åŸƒè²å°”é“å¡”', 'The Great Wall of China': 'ä¸­å›½é•¿åŸ',
            'The Mona Lisa': 'è’™å¨œä¸½è', 'tiger': 'è€è™', 'toaster': 'çƒ¤é¢åŒ…æœº',
            'toe': 'è„šè¶¾', 'toilet': 'é©¬æ¡¶', 'tooth': 'ç‰™é½¿', 'toothbrush': 'ç‰™åˆ·',
            'toothpaste': 'ç‰™è†', 'tornado': 'é¾™å·é£', 'tractor': 'æ‹–æ‹‰æœº',
            'traffic light': 'äº¤é€šç¯', 'train': 'ç«è½¦', 'tree': 'æ ‘', 'triangle': 'ä¸‰è§’å½¢',
            'trombone': 'é•¿å·', 'truck': 'å¡è½¦', 'trumpet': 'å°å·', 'umbrella': 'é›¨ä¼',
            'underwear': 'å†…è¡£', 'van': 'é¢åŒ…è½¦', 'vase': 'èŠ±ç“¶', 'violin': 'å°æç´',
            'washing machine': 'æ´—è¡£æœº', 'watermelon': 'è¥¿ç“œ', 'waterslide': 'æ°´æ»‘æ¢¯',
            'whale': 'é²¸é±¼', 'wheel': 'è½®å­', 'windmill': 'é£è½¦', 'wine bottle': 'é…’ç“¶',
            'wine glass': 'é…’æ¯', 'wristwatch': 'æ‰‹è¡¨', 'yoga': 'ç‘œä¼½', 'zebra': 'æ–‘é©¬',
            'zigzag': 'é”¯é½¿çº¿'
        };

        function translateCategory(cat) {
            const lower = cat.toLowerCase();
            return categoryTranslations[lower] || cat;
        }

        // Canvas è®¾ç½®
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentTool = 'pen'; // 'pen' or 'eraser'
        let brushSize = 6;

        // åˆå§‹åŒ– Canvas
        function initCanvas() {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            clearCanvas();
        }

        function clearCanvas() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // è·å–è§¦æ‘¸/é¼ æ ‡ä½ç½®
        function getPosition(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;
            
            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        // ç»˜åˆ¶
        function startDrawing(e) {
            e.preventDefault();
            isDrawing = true;
            const pos = getPosition(e);
            lastX = pos.x;
            lastY = pos.y;
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            
            const pos = getPosition(e);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(pos.x, pos.y);
            
            if (currentTool === 'eraser') {
                ctx.strokeStyle = 'white';
            } else {
                ctx.strokeStyle = '#333';
            }
            
            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
            
            lastX = pos.x;
            lastY = pos.y;
        }

        function stopDrawing(e) {
            if (e) e.preventDefault();
            isDrawing = false;
        }

        // äº‹ä»¶ç»‘å®š
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseleave', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing, { passive: false });
        canvas.addEventListener('touchmove', draw, { passive: false });
        canvas.addEventListener('touchend', stopDrawing, { passive: false });
        canvas.addEventListener('touchcancel', stopDrawing, { passive: false });

        // é˜»æ­¢é¡µé¢æ»šåŠ¨
        document.body.addEventListener('touchmove', (e) => {
            if (e.target === canvas) {
                e.preventDefault();
            }
        }, { passive: false });

        // å·¥å…·åˆ‡æ¢
        document.getElementById('penBtn').addEventListener('click', () => {
            currentTool = 'pen';
            document.getElementById('penBtn').classList.add('active');
            document.getElementById('eraserBtn').classList.remove('active');
            canvas.classList.remove('eraser-mode');
        });

        document.getElementById('eraserBtn').addEventListener('click', () => {
            currentTool = 'eraser';
            document.getElementById('eraserBtn').classList.add('active');
            document.getElementById('penBtn').classList.remove('active');
            canvas.classList.add('eraser-mode');
        });

        // ç”»ç¬”å¤§å°
        document.getElementById('sizeSlider').addEventListener('input', (e) => {
            brushSize = parseInt(e.target.value);
            document.getElementById('sizeLabel').textContent = brushSize;
        });

        // æ¸…é™¤æŒ‰é’®
        document.getElementById('clearBtn').addEventListener('click', () => {
            clearCanvas();
            document.getElementById('results').innerHTML = 
                '<div class="placeholder">åœ¨ä¸Šæ–¹ç”»æ¿ç»˜ç”»åç‚¹å‡»è¯†åˆ«</div>';
        });

        // è¯†åˆ«æŒ‰é’®
        document.getElementById('predictBtn').addEventListener('click', async () => {
            const btn = document.getElementById('predictBtn');
            btn.classList.add('loading-state');
            btn.disabled = true;

            try {
                const imageData = canvas.toDataURL('image/png');
                
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: imageData })
                });
                
                const data = await response.json();
                
                if (data.success && data.predictions.length > 0) {
                    showResults(data.predictions);
                } else {
                    showError();
                }
            } catch (error) {
                console.error('Error:', error);
                showError();
            } finally {
                btn.classList.remove('loading-state');
                btn.disabled = false;
            }
        });

        // æ˜¾ç¤ºç»“æœ
        function showResults(predictions) {
            const resultsDiv = document.getElementById('results');
            const rankLabels = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4', '5'];
            
            let html = '<div class="results-title">ğŸ¯ è¯†åˆ«ç»“æœ</div>';
            
            predictions.forEach((pred, index) => {
                const chineseName = translateCategory(pred.category);
                html += `
                    <div class="result-item">
                        <div class="result-rank">${rankLabels[index]}</div>
                        <span class="result-name">${chineseName}</span>
                        <div class="result-bar">
                            <div class="result-bar-fill" style="width: ${pred.confidence}%"></div>
                        </div>
                        <span class="result-conf">${pred.confidence}%</span>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function showError() {
            document.getElementById('results').innerHTML = 
                '<div class="placeholder">è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', initCanvas);
        window.addEventListener('resize', initCanvas);
    </script>
</body>
</html>
